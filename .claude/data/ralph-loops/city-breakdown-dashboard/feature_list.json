{
  "task_name": "city-breakdown-dashboard",
  "created": "2026-01-15",
  "total_features": 9,
  "completed_features": 8,
  "instructions": "CRITICAL: Only modify the 'passes' field. It is unacceptable to remove or edit feature definitions as this could lead to missing or buggy functionality.",
  "features": [
    {
      "id": 1,
      "category": "setup",
      "priority": "high",
      "description": "Add dialog state management to Dashboard for CreateLeadScrapeJob",
      "steps": [
        "Step 1: Add useState for createJobOpen (boolean)",
        "Step 2: Add useState for prefillScrapeData ({city, cuisine, pageOffset})",
        "Step 3: Create handleStartScrape callback that sets prefill data and opens dialog",
        "Step 4: Import CreateLeadScrapeJob component",
        "Step 5: Verify build passes with no TypeScript errors"
      ],
      "passes": true,
      "completed_iteration": 1,
      "notes": "Added useState hooks, handleStartScrape callback, imported and rendered CreateLeadScrapeJob dialog"
    },
    {
      "id": 2,
      "category": "functional",
      "priority": "high",
      "description": "CityBreakdownTab component renders on Dashboard",
      "steps": [
        "Step 1: Import CityBreakdownTab from @/components/reports/CityBreakdownTab",
        "Step 2: Add component between Recent Activity grid and Quick Actions card",
        "Step 3: Pass filters={{}} and onStartScrape={handleStartScrape} props",
        "Step 4: Wrap in Card with consistent Dashboard styling",
        "Step 5: Navigate to Dashboard and verify table renders with data"
      ],
      "passes": true,
      "completed_iteration": 2,
      "notes": "Imported CityBreakdownTab, wrapped in Card with brand-purple title, placed between Recent Activity and Quick Actions. Table renders with city data, heatmap, and summary stats."
    },
    {
      "id": 3,
      "category": "functional",
      "priority": "high",
      "description": "Expandable city rows work correctly",
      "steps": [
        "Step 1: Navigate to Dashboard",
        "Step 2: Click on a city row to expand",
        "Step 3: Verify cuisine breakdown appears with page indicators",
        "Step 4: Click again to collapse",
        "Step 5: Test Expand All / Collapse All button"
      ],
      "passes": true,
      "completed_iteration": 3,
      "notes": "Verified: Click city row expands to show cuisines with page indicators (numbered 1-10, green=scraped). Click again collapses. Expand All/Collapse All buttons work correctly."
    },
    {
      "id": 4,
      "category": "functional",
      "priority": "high",
      "description": "Clickable lead counts route to correct lead detail pages",
      "steps": [
        "Step 1: Navigate to Dashboard",
        "Step 2: Click on Total Leads count for a city",
        "Step 3: Verify new tab opens to /leads?tab=pending&city={city}",
        "Step 4: Expand a city row and click cuisine-level leads count",
        "Step 5: Verify new tab opens with city AND cuisine filter applied"
      ],
      "passes": true,
      "completed_iteration": 4,
      "notes": "Verified: Clicking Auckland '115' leads opens /leads?tab=pending&city=Auckland. Clicking burger '47' leads in expanded Auckland row opens /leads?tab=pending&city=Auckland&cuisine=burger. Both tabs show correctly filtered data."
    },
    {
      "id": 5,
      "category": "functional",
      "priority": "high",
      "description": "Cuisine coverage buttons trigger dialog for empty cuisines",
      "steps": [
        "Step 1: Navigate to Dashboard",
        "Step 2: Find a cuisine with 0 pages scraped (gray indicator)",
        "Step 3: Click the empty cuisine indicator",
        "Step 4: Verify CreateLeadScrapeJob dialog opens",
        "Step 5: Verify dialog is prefilled with correct city and cuisine"
      ],
      "passes": true,
      "completed_iteration": 5,
      "notes": "Fixed handleStartScrape signature mismatch (was expecting object destructuring but CityBreakdownTab passes positional args). Verified: Click BBQ for Auckland opens dialog prefilled with City=Auckland, Cuisine=BBQ. Click Mexican for Wellington opens dialog prefilled with City=Wellington, Cuisine=Mexican Food."
    },
    {
      "id": 6,
      "category": "functional",
      "priority": "high",
      "description": "Cuisine coverage buttons navigate for scraped cuisines",
      "steps": [
        "Step 1: Navigate to Dashboard",
        "Step 2: Find a cuisine with 1+ pages scraped (colored indicator)",
        "Step 3: Click the scraped cuisine indicator",
        "Step 4: Verify new tab opens to /leads?city={city}&cuisine={slug}",
        "Step 5: Verify leads list shows correctly filtered data"
      ],
      "passes": true,
      "completed_iteration": 6,
      "notes": "Verified: Clicking 'Burger: 4 pages scraped - Click to view leads' button for Auckland opens new tab to /leads?city=Auckland&cuisine=burger. Filters correctly applied. Pending Leads tab shows 4 leads with correct Auckland + Burger filter."
    },
    {
      "id": 7,
      "category": "functional",
      "priority": "medium",
      "description": "Page indicators work correctly (scraped vs unscraped)",
      "steps": [
        "Step 1: Navigate to Dashboard and expand a city row",
        "Step 2: Find a cuisine with some scraped pages (green indicators)",
        "Step 3: Click a scraped page indicator",
        "Step 4: Verify new tab opens to job detail /leads/{jobId}",
        "Step 5: Click an unscraped page indicator and verify dialog opens with page offset"
      ],
      "passes": true,
      "completed_iteration": 7,
      "notes": "Verified both page indicator behaviors: (1) Clicked green page 3 indicator for burger/Auckland -> opened job detail at /leads/db548503-2564-4ce0-90c7-00bef9cc5527 showing 'ubereats - burger - auckland' job with Page offset: 3. (2) Clicked gray page 7 indicator for burger/Auckland -> opened New Lead Scrape dialog prefilled with City=Auckland, Cuisine=Burgers, Page Offset=7."
    },
    {
      "id": 8,
      "category": "functional",
      "priority": "medium",
      "description": "CSV export button functions correctly",
      "steps": [
        "Step 1: Navigate to Dashboard",
        "Step 2: Locate the Export CSV button in city breakdown section",
        "Step 3: Click Export CSV button",
        "Step 4: Verify file download initiates",
        "Step 5: Verify downloaded CSV contains expected city/cuisine data"
      ],
      "passes": true,
      "completed_iteration": 8,
      "notes": "Verified: Export CSV button in City Breakdown section downloads scrape-coverage-2026-01-15.csv. File contains proper headers (City,Cuisine,Leads,Jobs,Pages Scraped) and data for all cities with scraped cuisines (Auckland, Wellington, Hamilton, Christchurch, Tauranga)."
    },
    {
      "id": 9,
      "category": "ui",
      "priority": "medium",
      "description": "Table styling matches existing Dashboard card patterns",
      "steps": [
        "Step 1: Navigate to Dashboard",
        "Step 2: Compare city breakdown card with existing Recent Restaurants card",
        "Step 3: Verify backdrop-blur-sm bg-background/95 border-border styling",
        "Step 4: Verify header layout matches (title left, action button right)",
        "Step 5: Check no console errors and responsive layout on resize"
      ],
      "passes": false,
      "completed_iteration": null,
      "notes": ""
    }
  ]
}
